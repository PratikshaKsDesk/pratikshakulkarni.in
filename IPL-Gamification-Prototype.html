<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VYE3TD08MC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VYE3TD08MC');
</script>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Product Leader Quest ‚Äî Standalone Fixed</title>
  <style>
    /* ====== Base ====== */
    :root {
      --bg: #000000;
      --surface: #0a0e27;
      --text: #00ffff;
      --accent: #8a2be2;
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: white;
      overflow-x: hidden;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(ellipse at top, #0a0e27 0%, #000000 50%),
        radial-gradient(ellipse at bottom, #1a0b2e 0%, #000000 50%);
      pointer-events: none;
      z-index: 0;
    }
    body::after {
      content: '';
      position: fixed; inset: 0;
      background-image:
        radial-gradient(2px 2px at 20% 30%, rgba(0,255,255,1), transparent),
        radial-gradient(1.5px 1.5px at 60% 70%, rgba(138,43,226,0.9), transparent),
        radial-gradient(3px 3px at 50% 50%, rgba(255,255,255,1), transparent),
        radial-gradient(2px 2px at 80% 10%, rgba(0,255,255,0.9), transparent),
        radial-gradient(1.5px 1.5px at 90% 60%, rgba(138,43,226,0.8), transparent),
        radial-gradient(2px 2px at 33% 50%, rgba(255,255,255,0.9), transparent);
      background-size: 200% 200%, 200% 200%, 300% 300%, 250% 250%, 200% 200%, 300% 300%;
      background-position: 0% 0%, 40% 60%, 50% 50%, 80% 10%, 90% 60%, 33% 50%;
      opacity: 1;
      pointer-events: none;
      z-index: 0;
      animation: twinkle 3s ease-in-out infinite;
    }
    @keyframes twinkle { 0%,100%{opacity:1} 50%{opacity:.7} }

    .particles { position: fixed; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
    .particle {
      position: absolute; width: 4px; height: 4px; border-radius: 50%;
      opacity: .8; animation: float-up 12s linear infinite;
      box-shadow: 0 0 10px rgba(0,255,255,.8), 0 0 20px rgba(0,255,255,.4);
    }
    @keyframes float-up {
      0%{ transform: translateY(100%) translateX(0) scale(0); opacity:0 }
      10%{ opacity:1 } 90%{ opacity:1 }
      100%{ transform: translateY(-100%) translateX(30px) scale(1); opacity:0 }
    }

    /* ====== Goal Selection ====== */
    .goal-selection-screen {
      min-height: 100dvh; display:flex; align-items:center; justify-content:center;
      padding:2rem; position:relative; z-index:1;
    }
    .goal-container { max-width:1000px; width:100%; text-align:center; }
    .goal-header { margin-bottom:3rem; animation: fadeInDown .8s ease-out; position:relative; }
    .rocket-icon { font-size: 5rem; margin-bottom:1rem; display:inline-block; animation: rocketFloat 3s ease-in-out infinite; filter: drop-shadow(0 0 20px rgba(0,255,255,.6)); }
    @keyframes rocketFloat { 0%,100%{transform:translateY(0) rotate(-5deg)} 50%{transform:translateY(-20px) rotate(5deg)} }
    @keyframes fadeInDown { from{opacity:0; transform:translateY(-30px)} to{opacity:1; transform:translateY(0)} }
    .goal-header h1 { font-size: clamp(2rem, 3vw + 1rem, 3rem); color: var(--text); margin:0 0 1rem; font-weight:700; letter-spacing:2px; text-shadow: 0 0 20px rgba(0,255,255,.5), 0 0 40px rgba(0,255,255,.3); text-transform:uppercase; }
    .goal-header p { font-size:1.05rem; color: rgba(255,255,255,.75); margin:0; font-weight:300; letter-spacing:1px; }
    .goal-cards {
      display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:1.25rem; margin-bottom:2rem;
    }
    .goal-card {
      background: rgba(10,14,39,.6); border-radius: var(--radius);
      padding: 1.75rem 1.25rem; cursor:pointer;
      transition: all .35s cubic-bezier(.34, 1.56, .64, 1);
      box-shadow: 0 0 30px rgba(0,255,255,.1), inset 0 0 20px rgba(0,255,255,.05);
      position:relative; overflow:hidden; border:1px solid rgba(0,255,255,.3); backdrop-filter: blur(10px);
    }
    .goal-card:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 0 50px rgba(0,255,255,.4), 0 0 100px rgba(138,43,226,.2), inset 0 0 30px rgba(0,255,255,.1); border-color: rgba(0,255,255,.8); }
    .goal-icon { font-size:2.25rem; margin-bottom:.5rem; display:block; filter: drop-shadow(0 0 10px rgba(0,255,255,.5)); }
    .goal-title { font-size:1.1rem; font-weight:700; color: var(--text); margin:0 0 .4rem; letter-spacing:1px; text-transform:uppercase; }
    .goal-description { font-size:.9rem; color: rgba(255,255,255,.7); margin:0 }

    /* ====== Game Screen ====== */
    .game-screen { display:none; min-height: 100dvh; padding:2rem; position:relative; z-index:1; }
    .game-screen.active { display:block; }
    .game-container { max-width: 1200px; margin: 0 auto; }
    .game-header {
      background: rgba(10,14,39,.7); border-radius: var(--radius); padding: 1.25rem 1.5rem; margin-bottom: 1.5rem;
      box-shadow: 0 0 40px rgba(0,255,255,.2), inset 0 0 20px rgba(0,255,255,.05);
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;
      border:1px solid rgba(0,255,255,.3); backdrop-filter: blur(10px);
    }
    .game-info { display:flex; align-items:center; gap:1rem; }
    .goal-badge, .level-badge {
      background: linear-gradient(135deg, rgba(0,255,255,.2) 0%, rgba(138,43,226,.2) 100%);
      color: var(--text); padding: .55rem 1rem; border-radius: 50px; font-weight:700; font-size:.9rem;
      box-shadow: 0 0 20px rgba(0,255,255,.3), inset 0 0 10px rgba(0,255,255,.1);
      border:1px solid rgba(0,255,255,.5); text-transform: uppercase; letter-spacing:1px;
    }
    .game-title-section h2 { margin:0; font-size:1.35rem; color: var(--text); font-weight:800; letter-spacing:2px; text-shadow: 0 0 10px rgba(0,255,255,.5); text-transform:uppercase; }
    .game-title-section p { margin:.2rem 0 0; color: rgba(255,255,255,.65); font-size:.9rem; letter-spacing:.5px; }
    .player-stats { display:flex; gap:1.5rem; align-items:center; }
    .stat-item { text-align:center; }
    .stat-value { font-size:1.4rem; font-weight:800; color: var(--text); display:flex; align-items:center; gap:.5rem; justify-content:center; text-shadow: 0 0 10px rgba(0,255,255,.5) }
    .stat-label { font-size:.7rem; color: rgba(255,255,255,.6); text-transform:uppercase; letter-spacing:1px; margin-top:.2rem; font-weight:600; }

    .quest-map {
      background: rgba(10,14,39,.7); border-radius: var(--radius); padding: 2rem 1.25rem;
      box-shadow: 0 0 40px rgba(0,255,255,.2), inset 0 0 20px rgba(0,255,255,.05);
      position:relative; overflow:hidden; border:1px solid rgba(0,255,255,.3); backdrop-filter: blur(10px);
    }
    .quest-path { position:relative; display:flex; flex-direction:column; gap:2.25rem; max-width: 960px; margin: 0 auto; }
    .quest-row { display:flex; justify-content:center; align-items:center; gap:2.25rem; position:relative; }
    .quest-row:nth-child(even){ flex-direction: row-reverse; }
    .quest-row::before {
      content:''; position:absolute; width:2px; height:100%;
      background: linear-gradient(180deg, rgba(0,255,255,.3) 0%, rgba(138,43,226,.3) 100%);
      left:50%; transform: translateX(-50%); z-index:0; box-shadow:0 0 10px rgba(0,255,255,.5);
    }

    .level-node { position:relative; width:90px; height:90px; cursor:pointer; transition: all .3s ease; z-index:1; }
    .level-node:hover:not(.locked) { transform: scale(1.1); filter: brightness(1.25) drop-shadow(0 0 30px rgba(0,255,255,.8)); }
    .level-node.locked { opacity:.35; cursor:not-allowed; filter: grayscale(100%); }
    .level-circle {
      width:100%; height:100%; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.6rem;
      box-shadow: 0 0 30px rgba(0,255,255,.3), inset 0 0 20px rgba(0,255,255,.1);
      border:2px solid rgba(0,255,255,.5); position:relative;
      background: linear-gradient(135deg, rgba(0,255,255,.2) 0%, rgba(138,43,226,.2) 100%); backdrop-filter: blur(10px);
    }
    .level-node.learning .level-circle { background: linear-gradient(135deg, rgba(0,191,255,.2) 0%, rgba(0,255,255,.2) 100%); border-color: rgba(0,191,255,.6); }
    .level-node.social .level-circle   { background: linear-gradient(135deg, rgba(138,43,226,.2) 0%, rgba(186,85,211,.2) 100%); border-color: rgba(138,43,226,.6); }
    .level-node.quest .level-circle    { background: linear-gradient(135deg, rgba(255,0,255,.2) 0%, rgba(138,43,226,.2) 100%); border-color: rgba(255,0,255,.6); }
    .level-node.course .level-circle   { background: linear-gradient(135deg, rgba(0,255,255,.2) 0%, rgba(0,255,127,.2) 100%); border-color: rgba(0,255,255,.6); }
    .level-node.career .level-circle   { background: linear-gradient(135deg, rgba(255,215,0,.2) 0%, rgba(255,165,0,.2) 100%); border-color: rgba(255,215,0,.6); }

    .level-node.completed .level-circle::after {
      content:'‚úì'; position:absolute; top:-12px; right:-12px; width:36px; height:36px;
      background: linear-gradient(135deg, rgba(0,255,127,.9), rgba(0,255,255,.9)); color:#000; border-radius:50%;
      display:flex; align-items:center; justify-content:center; font-size:1.2rem; font-weight:900;
      border:2px solid rgba(0,255,255,.8); box-shadow: 0 0 30px rgba(0,255,127,.8);
    }
    .level-label {
      position:absolute; bottom:-36px; left:50%; transform:translateX(-50%);
      background: rgba(10,14,39,.9); color: var(--text);
      padding:.35rem .75rem; border-radius: 20px; font-size:.75rem; font-weight:700; white-space:nowrap;
      box-shadow: 0 0 20px rgba(0,255,255,.3); border:1px solid rgba(0,255,255,.5); letter-spacing:.5px; text-transform:uppercase;
    }
    .level-stars { position:absolute; top:-16px; left:50%; transform:translateX(-50%); display:flex; gap:2px; font-size:.95rem; filter: drop-shadow(0 0 5px rgba(255,215,0,.8)); }

    /* ====== Modal ====== */
    .modal-overlay { display:none; position:fixed; inset:0; background: rgba(0,0,0,.9); z-index:1000; align-items:center; justify-content:center; padding:1rem; backdrop-filter: blur(10px); }
    .modal-overlay.active { display:flex; }
    .modal {
      background: rgba(10,14,39,.95); border-radius: 20px; padding: 2rem; max-width: 520px; width: 100%;
      box-shadow: 0 0 60px rgba(0,255,255,.4), inset 0 0 30px rgba(0,255,255,.1);
      max-height: 90%; overflow-y:auto; border:1px solid rgba(0,255,255,.5); backdrop-filter: blur(20px);
    }
    .modal-header { text-align:center; margin-bottom: 1.25rem; }
    .modal-icon { font-size: 4rem; margin-bottom:.5rem; filter: drop-shadow(0 0 20px rgba(0,255,255,.6)); }
    .modal h2 { margin:.25rem 0 .5rem; font-size:1.6rem; color: var(--text); font-weight:900; text-shadow:0 0 20px rgba(0,255,255,.5); letter-spacing:1px; text-transform:uppercase; }
    .modal-type { display:inline-block; padding:.35rem 1rem; border-radius:20px; font-size:.8rem; font-weight:800; text-transform:uppercase; letter-spacing:1px; border:1px solid; }
    .modal-type.learning{ background: rgba(0,191,255,.2); color:#00bfff; border-color: rgba(0,191,255,.5); }
    .modal-type.social{ background: rgba(138,43,226,.2); color:#ba55d3; border-color: rgba(138,43,226,.5); }
    .modal-type.quest{ background: rgba(255,0,255,.2); color:#ff00ff; border-color: rgba(255,0,255,.5); }
    .modal-type.course{ background: rgba(0,255,255,.2); color:#00ffff; border-color: rgba(0,255,255,.5); }
    .modal-type.career{ background: rgba(255,215,0,.2); color:#ffd700; border-color: rgba(255,215,0,.5); }
    .modal-description { color: rgba(255,255,255,.75); line-height:1.7; margin-bottom:1rem; font-size:1rem; text-align:center; }
    .demo-content { background: rgba(0,255,255,.05); border-radius: 12px; padding: 1rem; margin: 1rem 0; border:1px solid rgba(0,255,255,.3); max-height: 300px; overflow-y:auto; }
    .demo-content h3 { margin: 0 0 .75rem; color: var(--text); font-size:1.05rem; font-weight:800; text-transform:uppercase; letter-spacing:1px; }
    .demo-content p { margin:.6rem 0; color: rgba(255,255,255,.75); line-height:1.6; font-size:.95rem; }
    .demo-content ul { margin:.5rem 0; padding-left:1.25rem; color: rgba(255,255,255,.75); }
    .demo-content li { margin:.4rem 0; line-height:1.5; }

    .modal-actions { display:flex; gap:.75rem; margin-top:1rem; }
    .btn { flex:1; padding:.85rem; border:none; border-radius: 10px; font-size:1rem; font-weight:800; cursor:pointer; transition: all .25s; font-family: inherit; letter-spacing:1px; text-transform: uppercase; }
    .btn-primary { background: linear-gradient(135deg, rgba(0,255,255,.25) 0%, rgba(138,43,226,.25) 100%); color: var(--text); box-shadow: 0 0 30px rgba(0,255,255,.3), inset 0 0 20px rgba(0,255,255,.1); position:relative; overflow:hidden; border:1px solid rgba(0,255,255,.5); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 50px rgba(0,255,255,.6), inset 0 0 30px rgba(0,255,255,.2); border-color: rgba(0,255,255,.8); }
    .btn-primary:disabled { opacity:.4; cursor:not-allowed; }
    .btn-secondary { background: rgba(255,255,255,.06); color: rgba(255,255,255,.75); border:1px solid rgba(255,255,255,.25) }
    .btn-secondary:hover { background: rgba(255,255,255,.12); color: rgba(255,255,255,.95) }

    .disclaimer {
      background: rgba(10,14,39,.7); border-radius: 12px; padding: 1rem 1.25rem; margin-top: 1.25rem;
      box-shadow: 0 0 30px rgba(255,165,0,.2); border:1px solid rgba(255,165,0,.4); border-left: 4px solid rgba(255,165,0,.8);
    }
    .disclaimer p { margin:0; color: rgba(255,255,255,.75); line-height:1.6; font-size:.9rem; }
    .disclaimer strong { color: #ffa500; }

    .toast {
      position: fixed; top: 1.25rem; right: 1.25rem;
      background: rgba(10,14,39,.95); padding: 1rem 1.25rem; border-radius: 16px;
      box-shadow: 0 0 50px rgba(0,255,255,.4), inset 0 0 20px rgba(0,255,255,.1);
      display:flex; align-items:center; gap:.75rem; z-index: 2000; max-width: 340px;
      border:1px solid rgba(0,255,255,.5); backdrop-filter: blur(20px);
      animation: slideInRight .45s cubic-bezier(.34, 1.56, .64, 1)
    }
    @keyframes slideInRight { from{opacity:0; transform: translateX(120px) scale(.95)} to{opacity:1; transform: translateX(0) scale(1)} }
    .toast-icon { font-size: 1.5rem; filter: drop-shadow(0 0 10px rgba(0,255,255,.6)); }
    .toast-message { font-weight:800; color: var(--text); font-size: .95rem; text-shadow: 0 0 10px rgba(0,255,255,.3); }

    .change-goal-btn {
      background: transparent; border: 2px solid rgba(0,255,255,.5); color: var(--text);
      padding: .55rem 1rem; border-radius: 50px; font-size:.85rem; font-weight:800; cursor:pointer; transition: all .25s;
      letter-spacing:1px; text-transform: uppercase;
    }
    .change-goal-btn:hover { background: rgba(0,255,255,.2); border-color: rgba(0,255,255,.8); transform: translateY(-1px); box-shadow: 0 0 30px rgba(0,255,255,.4); }

    @media (max-width: 768px) {
      .goal-cards { grid-template-columns: 1fr; gap: 1rem; }
      .game-header { flex-direction: column; text-align:center; }
      .player-stats { width:100%; justify-content:space-around; }
      .quest-row { flex-direction: column !important; gap: 1.5rem; }
      .quest-row::before { width:100%; height:2px; top:50%; transform: translateY(-50%); }
    }
  </style>
</head>
<body>
  <!-- Space particles -->
  <div class="particles" id="particles"></div>

  <!-- Goal Selection Screen -->
  <div class="goal-selection-screen" id="goal-selection">
    <div class="goal-container">
      <div class="goal-header">
        <div class="rocket-icon">üöÄ</div>
        <h1 id="goal-screen-title">Choose Your Quest</h1>
        <p id="goal-screen-tagline">Select your career goal to begin your journey</p>
      </div>
      <div class="goal-cards">
        <div class="goal-card" data-goal="Product Manager">
          <span class="goal-icon">üì±</span>
          <h3 class="goal-title">Product Manager</h3>
          <p class="goal-description">Master product strategy, user research, and roadmap planning</p>
        </div>
        <div class="goal-card" data-goal="Senior PM">
          <span class="goal-icon">üöÄ</span>
          <h3 class="goal-title">Senior PM</h3>
          <p class="goal-description">Lead complex products and mentor junior team members</p>
        </div>
        <div class="goal-card" data-goal="VP Product">
          <span class="goal-icon">‚ö°</span>
          <h3 class="goal-title">VP Product</h3>
          <p class="goal-description">Drive product vision and build high-performing teams</p>
        </div>
        <div class="goal-card" data-goal="Chief Product Officer">
          <span class="goal-icon">üëë</span>
          <h3 class="goal-title">Chief Product Officer</h3>
          <p class="goal-description">Shape company strategy and lead product organization</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Game Screen -->
  <div class="game-screen" id="game-screen">
    <div class="game-container">
      <div class="game-header">
        <div class="game-info">
          <div class="goal-badge"><span>üéØ</span> <span id="selected-goal">Product Manager</span></div>
          <div class="game-title-section">
            <h2 id="game-title">Product Leader Quest</h2>
            <p id="game-tagline">Your journey to product leadership excellence</p>
          </div>
        </div>
        <div class="player-stats">
          <div class="stat-item">
            <div class="stat-value"><span>‚≠ê</span> <span id="total-stars">0</span></div>
            <div class="stat-label">Stars</div>
          </div>
          <div class="level-badge"><span id="player-level">Level 1</span></div>
          <div class="stat-item">
            <div class="stat-value"><span id="completed-count">0</span> <span style="font-size: 1rem;">/21</span></div>
            <div class="stat-label">Completed</div>
          </div>
        </div>
        <button class="change-goal-btn" id="change-goal">Change Goal</button>
      </div>

      <div class="quest-map">
        <div class="quest-path" id="quest-path"></div>
      </div>

      <div class="disclaimer">
        <p><strong>üí° Important:</strong> <span id="disclaimer-text">This is a motivational game designed to inspire learning and growth. It's not a guaranteed path to success, but a fun way to stay motivated, keep learning, and celebrate your progress. Complete quests, add real career achievements, and level up your product leadership skills!</span></p>
      </div>
    </div>
  </div>

  <!-- Level Modal -->
  <div class="modal-overlay" id="level-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-icon" id="modal-icon">üìö</div>
        <h2 id="modal-title">Level Title</h2>
        <span class="modal-type" id="modal-type">learning</span>
      </div>
      <div class="modal-body">
        <p class="modal-description" id="modal-description">Complete this quest to earn stars!</p>
        <div class="demo-content" id="demo-content"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="close-modal">Cancel</button>
        <button class="btn btn-primary" id="complete-btn"><span id="complete-text">Done ‚úì</span></button>
      </div>
    </div>
  </div>

  <script>
    // ====== Local Standalone SDK Polyfills (No external /_sdk/* needed) ======
    (function(){
      const STORAGE_KEY = "plq_game_data_v1";
      function readData(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]"); }catch(e){ return []; } }
      function writeData(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

      // dataSdk polyfill ‚Äî NO PERSISTENCE (clears on every refresh)
      (function(){
        let memoryData = []; // reset on each page load

        window.dataSdk = {
          _handler: null,
          async init(handler){
            this._handler = handler || null;
            if (this._handler?.onDataChanged) this._handler.onDataChanged(memoryData);
            return { isOk: true };
          },
          async create(entry){
            memoryData.push(entry);
            if (this._handler?.onDataChanged) this._handler.onDataChanged(memoryData);
            return { isOk: true };
          }
        };
      })();


      // elementSdk polyfill (configurable theme)
      const defaultConfig = {
        game_title: "Product Leader Quest",
        tagline: "Your journey to product leadership excellence",
        disclaimer_text: "This is a motivational game designed to inspire learning and growth. It's not a guaranteed path to success, but a fun way to stay motivated, keep learning, and celebrate your progress.",
        background_color: "#000000",
        surface_color: "#0a0e27",
        text_color: "#00ffff",
        primary_action_color: "#00ffff",
        secondary_action_color: "#8a2be2",
        font_family: "Inter",
        font_size: 16
      };
      window.elementSdk = {
        config: { ...defaultConfig },
        setConfig(patch){
          this.config = { ...this.config, ...patch };
          document.documentElement.style.setProperty("--bg", this.config.background_color || "#000000");
          document.documentElement.style.setProperty("--surface", this.config.surface_color || "#0a0e27");
          document.documentElement.style.setProperty("--text", this.config.text_color || "#00ffff");
          document.documentElement.style.setProperty("--accent", this.config.secondary_action_color || "#8a2be2");
          document.body.style.fontFamily = (this.config.font_family || "Inter") + ', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
          document.body.style.fontSize = (this.config.font_size || 16) + "px";
          // update headings
          document.getElementById("game-title").textContent = this.config.game_title || defaultConfig.game_title;
          document.getElementById("game-tagline").textContent = this.config.tagline || defaultConfig.tagline;
          document.getElementById("disclaimer-text").textContent = this.config.disclaimer_text || defaultConfig.disclaimer_text;
        },
        init({ defaultConfig: dc, onConfigChange }){
          // immediately apply defaults
          this.setConfig(this.config);
          if (onConfigChange) onConfigChange(this.config);
        }
      };
    })();

    // ====== Game Levels ======
    const GAME_LEVELS = [
      { id:'level-1',  type:'learning', icon:'üìñ', title:'1-Min Tip', description:'Quick insight: The power of user feedback in product decisions',
        demoContent:{ title:'The Power of User Feedback', content:'User feedback is the compass that guides product decisions. Learn how top product managers leverage customer insights to build products people love.', points:['Listen actively to user pain points','Validate assumptions with real data','Iterate based on feedback loops'] } },
      { id:'level-1b', type:'course',   icon:'üéì', title:'Apply for Course', description:'Apply for our Product Management Foundations course',
        demoContent:{ title:'PM Foundations Course', content:'Ready to level up? Apply for our comprehensive Product Management Foundations course. Learn from industry experts and get certified.', points:['12-week intensive program','Live sessions with PM leaders','Career support included'], isApplication:true, courseLink:'#apply-pm-foundations' } },
      { id:'level-2',  type:'learning', icon:'üí°', title:'1-Min Tip', description:'Quick tip: Prioritization frameworks for busy PMs',
        demoContent:{ title:'Smart Prioritization', content:'Learn the RICE framework to make better prioritization decisions quickly and confidently.', points:['Reach: How many users?','Impact: How much value?','Confidence: How sure are you?','Effort: How much work?'] } },
      { id:'level-3',  type:'social',   icon:'üì±', title:'Watch Reel', description:'Watch our latest product management tips reel on Instagram',
        demoContent:{ title:'PM Tips Video Series', content:'Watch engaging 60-second videos covering essential PM concepts, from user stories to sprint planning.', points:['Daily PM tips and tricks','Real-world case studies','Expert interviews'] } },
      { id:'level-4',  type:'learning', icon:'üìù', title:'1-Min Tip', description:'Quick tip: Writing effective user stories',
        demoContent:{ title:'User Story Mastery', content:'Master the art of writing clear, actionable user stories that your team will love.', points:['As a [user], I want [goal]','So that [benefit]','Include acceptance criteria'] } },
      { id:'level-5',  type:'social',   icon:'üë•', title:'Follow Us', description:'Follow our social media pages for daily PM insights',
        demoContent:{ title:'Join Our Community', content:'Connect with 50,000+ product managers worldwide. Get daily insights, templates, and career advice.', points:['Daily PM insights','Free templates and resources','Networking opportunities'] } },
      { id:'level-6',  type:'learning', icon:'üéØ', title:'1-Min Tip', description:'Quick tip: Running effective sprint planning',
        demoContent:{ title:'Sprint Planning Success', content:'Run sprint planning meetings that energize your team and set clear goals.', points:['Review sprint goals','Estimate story points','Commit as a team'] } },
      { id:'level-7',  type:'social',   icon:'ü§ù', title:'Refer a Friend', description:'Share this journey with a fellow product leader',
        demoContent:{ title:'Grow Together', content:'Learning is better with friends. Invite fellow PMs to join the quest and unlock bonus content.', points:['Share your progress','Unlock bonus levels','Build your PM network'] } },
      { id:'level-8',  type:'learning', icon:'üìä', title:'1-Min Tip', description:'Quick tip: Key metrics every PM should track',
        demoContent:{ title:'Essential PM Metrics', content:'Focus on the metrics that matter most for product success.', points:['Activation rate','Retention rate','Feature adoption','Customer satisfaction'] } },
      { id:'level-9',  type:'quest',    icon:'üéÆ', title:'PM Quest', description:'Interactive challenge: Prioritize features for maximum impact',
        demoContent:{ title:'Feature Prioritization Challenge', content:'You have 10 features and limited resources. Use frameworks like RICE and Kano to make strategic decisions.', points:['Apply RICE scoring method','Balance user value vs effort','Make data-driven decisions'] } },
      { id:'level-10', type:'learning', icon:'üöÄ', title:'1-Min Tip', description:'Quick tip: Stakeholder management essentials',
        demoContent:{ title:'Managing Stakeholders', content:'Build strong relationships with stakeholders and keep everyone aligned.', points:['Communicate early and often','Manage expectations','Show progress regularly'] } },
      { id:'level-11', type:'course',   icon:'üéì', title:'Apply for Course', description:'Apply for our Advanced Product Strategy course',
        demoContent:{ title:'Advanced Product Strategy', content:'Take your strategic thinking to the next level. Apply for our Advanced Product Strategy course and master competitive positioning.', points:['8-week advanced program','Real-world case studies','Strategy frameworks mastery'], isApplication:true, courseLink:'#apply-advanced-strategy' } },
      { id:'level-12', type:'learning', icon:'üí¨', title:'1-Min Tip', description:'Quick tip: Customer interview techniques',
        demoContent:{ title:'Interview Like a Pro', content:'Ask the right questions to uncover real user needs and pain points.', points:['Ask open-ended questions','Listen more than you talk','Dig deeper with "why"'] } },
      { id:'level-13', type:'social',   icon:'üí¨', title:'Join Community', description:'Join our PM community and introduce yourself',
        demoContent:{ title:'PM Community Hub', content:'Join thousands of product managers sharing experiences, asking questions, and growing together.', points:['Weekly discussion threads','Mentorship opportunities','Career advice and support'] } },
      { id:'level-14', type:'learning', icon:'üîç', title:'1-Min Tip', description:'Quick tip: Competitive analysis frameworks',
        demoContent:{ title:'Competitive Intelligence', content:'Understand your competition and find your unique positioning.', points:['Map competitor features','Identify gaps and opportunities','Define your differentiation'] } },
      { id:'level-15', type:'quest',    icon:'üß©', title:'Strategy Quest', description:'Solve: Market positioning challenge',
        demoContent:{ title:'Market Positioning Simulation', content:'Analyze a competitive market and position your product for success. Make strategic decisions that impact market share.', points:['Analyze competitive landscape','Define unique value proposition','Target the right customer segment'] } },
      { id:'level-16', type:'learning', icon:'‚ö°', title:'1-Min Tip', description:'Quick tip: Roadmap communication strategies',
        demoContent:{ title:'Roadmap Communication', content:'Share your roadmap effectively with different audiences.', points:['Tailor message to audience','Focus on outcomes, not features','Be transparent about tradeoffs'] } },
      { id:'level-17', type:'course',   icon:'ü§ñ', title:'Apply for Course', description:'Apply for our AI for Product Managers course',
        demoContent:{ title:'AI for Product Managers', content:'Master the future of product management. Apply for our AI for PMs course and learn to build intelligent products.', points:['6-week AI/ML intensive','Hands-on AI projects','Data science collaboration'], isApplication:true, courseLink:'#apply-ai-for-pms' } },
      { id:'level-18', type:'learning', icon:'üé®', title:'1-Min Tip', description:'Quick tip: Working with designers effectively',
        demoContent:{ title:'PM-Designer Collaboration', content:'Build strong partnerships with designers for better products.', points:['Involve designers early','Share user insights','Respect the design process'] } },
      { id:'level-19', type:'quest',    icon:'üéØ', title:'Roadmap Quest', description:'Build a product roadmap for a startup scenario',
        demoContent:{ title:'Roadmap Planning Challenge', content:'Create a strategic roadmap for a fast-growing startup. Balance short-term wins with long-term vision.', points:['Define product themes','Sequence initiatives strategically','Communicate roadmap to stakeholders'] } },
      { id:'level-20', type:'learning', icon:'üíº', title:'1-Min Tip', description:'Quick tip: Career growth for product managers',
        demoContent:{ title:'PM Career Growth', content:'Accelerate your product management career with these proven strategies.', points:['Build a strong portfolio','Network with other PMs','Keep learning new skills'] } },
      { id:'level-21', type:'career',   icon:'üëë', title:'Goal Achieved!', description:'Congratulations! You have reached your career goal!',
        demoContent:{ title:'üéâ Goal Achieved!', content:'Incredible work! You have completed your journey and achieved your career goal. You are now ready to lead as a product professional!', points:['All courses completed','Skills mastered','Ready for leadership roles'], isGoalAchieved:true } }
    ];

    // ====== State ======
    let gameData = [];
    let currentLevel = null;
    let isSubmitting = false;
    let selectedGoal = '';

    // ====== Helpers ======
    function showToast(message, icon='‚ú®'){
      const old = document.querySelector('.toast'); if (old) old.remove();
      const el = document.createElement('div'); el.className = 'toast';
      el.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-message">${message}</span>`;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 2400);
    }

    function updateStats(){
      const totalStars = gameData.reduce((sum, d)=> sum + (d.stars || 0), 0);
      const completedCount = gameData.filter(d=> d.completed).length;
      const level = Math.floor(completedCount / 4) + 1;
      document.getElementById('total-stars').textContent = totalStars;
      document.getElementById('completed-count').textContent = completedCount;
      document.getElementById('player-level').textContent = `Level ${level}`;
    }

    function renderQuestMap(){
      const container = document.getElementById('quest-path');
      let html = '';
      for (let i = 0; i < GAME_LEVELS.length; i += 2){
        html += '<div class="quest-row">';
        const L1 = GAME_LEVELS[i];
        const done1 = gameData.find(d => d.level_id === L1.id);
        const lock1 = i > 0 && !gameData.find(d => d.level_id === GAME_LEVELS[i-1].id);
        html += `
          <div class="level-node ${L1.type} ${done1 ? 'completed' : ''} ${lock1 ? 'locked' : ''}" data-level="${L1.id}">
            <div class="level-circle">${L1.icon}</div>
            ${done1 ? `<div class="level-stars">${'‚≠ê'.repeat(done1.stars || 3)}</div>` : ''}
            <div class="level-label">${L1.title}</div>
          </div>`;
        if (i + 1 < GAME_LEVELS.length){
          const L2 = GAME_LEVELS[i+1];
          const done2 = gameData.find(d => d.level_id === L2.id);
          const lock2 = !gameData.find(d => d.level_id === GAME_LEVELS[i].id);
          html += `
            <div class="level-node ${L2.type} ${done2 ? 'completed' : ''} ${lock2 ? 'locked' : ''}" data-level="${L2.id}">
              <div class="level-circle">${L2.icon}</div>
              ${done2 ? `<div class="level-stars">${'‚≠ê'.repeat(done2.stars || 3)}</div>` : ''}
              <div class="level-label">${L2.title}</div>
            </div>`;
        }
        html += '</div>';
      }
      container.innerHTML = html;
    }

    function openLevelModal(levelId){
      const L = GAME_LEVELS.find(l => l.id === levelId);
      if (!L) return;
      const already = gameData.find(d => d.level_id === levelId);
      if (already){ showToast('Already completed! üéâ', '‚úÖ'); return; }
      currentLevel = L;
      document.getElementById('modal-icon').textContent = L.icon;
      document.getElementById('modal-title').textContent = L.title;
      const mt = document.getElementById('modal-type');
      mt.textContent = L.type; mt.className = `modal-type ${L.type}`;
      document.getElementById('modal-description').textContent = L.description;
      const demo = document.getElementById('demo-content');
      let extra = '';
      if (L.demoContent?.isApplication){
        extra = `<div style="margin-top:1rem;padding:1rem;background:linear-gradient(135deg,rgba(0,255,255,.2),rgba(138,43,226,.2));border-radius:8px;text-align:center;border:1px solid rgba(0,255,255,.4)"><p style="color:var(--text);margin:0;font-weight:800">üìù Click "Done ‚úì" to mark your application as submitted!</p></div>`;
      } else if (L.demoContent?.isGoalAchieved){
        extra = `<div style="margin-top:1rem;padding:1rem;background:linear-gradient(135deg,rgba(0,255,127,.2),rgba(0,255,255,.2));border-radius:8px;text-align:center;border:1px solid rgba(0,255,127,.5)"><p style="color:#00ff7f;margin:0;font-size:1.05rem;font-weight:900;text-shadow:0 0 10px rgba(0,255,127,.5)">üèÜ You are now a certified Product Leader!</p></div>`;
      }
      demo.innerHTML = `
        <h3>${L.demoContent?.title || ''}</h3>
        <p>${L.demoContent?.content || ''}</p>
        <ul>${(L.demoContent?.points || []).map(pt => `<li>${pt}</li>`).join('')}</ul>
        <div style="margin-top:.75rem;">
          <span class="demo-badge" style="display:inline-block;background:linear-gradient(135deg,rgba(0,255,255,.3),rgba(138,43,226,.3));color:var(--text);padding:.25rem .6rem;border-radius:20px;font-size:.75rem;font-weight:800;border:1px solid rgba(0,255,255,.5);text-transform:uppercase;">${L.type.toUpperCase()}</span>
          ${L.demoContent?.isApplication ? '<span class="demo-badge" style="display:inline-block;background:linear-gradient(135deg,rgba(0,255,255,.3),rgba(138,43,226,.3));color:var(--text);padding:.25rem .6rem;border-radius:20px;font-size:.75rem;font-weight:800;border:1px solid rgba(0,255,255,.5);text-transform:uppercase;">Apply Now</span>' : '<span class="demo-badge" style="display:inline-block;background:linear-gradient(135deg,rgba(0,255,255,.3),rgba(138,43,226,.3));color:var(--text);padding:.25rem .6rem;border-radius:20px;font-size:.75rem;font-weight:800;border:1px solid rgba(0,255,255,.5);text-transform:uppercase;">Interactive</span>'}
        </div>
        ${extra}`;
      document.getElementById('level-modal').classList.add('active');
    }

    function closeModal(){
      document.getElementById('level-modal').classList.remove('active');
      currentLevel = null;
    }

    async function completeLevel(){
      if (!currentLevel || isSubmitting) return;
      isSubmitting = true;
      const btn = document.getElementById('complete-btn');
      const txt = document.getElementById('complete-text');
      btn.disabled = true; txt.textContent = 'Saving...';

      const completion = {
        goal_selected: selectedGoal,
        level_id: currentLevel.id,
        level_type: currentLevel.type,
        completed: true,
        stars: 3,
        timestamp: new Date().toISOString(),
        career_title: '',
        career_description: ''
      };
      const result = await window.dataSdk.create(completion);
      isSubmitting = false; btn.disabled = false; txt.textContent = 'Done ‚úì';

      if (result.isOk){ showToast('Quest completed! üéâ', '‚úÖ'); closeModal(); }
      else { showToast('Failed to complete quest. Please try again.', '‚ùå'); }
    }

    function createParticles(){
      const particles = document.getElementById('particles');
      const n = 30;
      const colors = ['rgba(0,255,255,.8)', 'rgba(138,43,226,.8)', 'rgba(255,255,255,.9)'];
      for (let i = 0; i < n; i++){
        const p = document.createElement('div'); p.className = 'particle';
        p.style.left = Math.random()*100 + '%';
        p.style.animationDelay = Math.random()*12 + 's';
        p.style.animationDuration = (Math.random()*8 + 10) + 's';
        const c = colors[Math.floor(Math.random()*colors.length)];
        p.style.background = c;
        particles.appendChild(p);
      }
    }

    function wireEvents(){
      document.querySelectorAll('.goal-card').forEach(card => {
        card.addEventListener('click', async () => {
          if (isSubmitting) return;
          selectedGoal = card.getAttribute('data-goal');
          document.getElementById('selected-goal').textContent = selectedGoal;
          document.getElementById('goal-selection').style.display = 'none';
          document.getElementById('game-screen').classList.add('active');
          await window.dataSdk.create({
            goal_selected: selectedGoal,
            level_id: 'goal',
            level_type: 'goal',
            completed: false,
            stars: 0,
            timestamp: new Date().toISOString(),
            career_title: '',
            career_description: ''
          });
        });
      });
      document.getElementById('change-goal').addEventListener('click', () => {
        document.getElementById('game-screen').classList.remove('active');
        document.getElementById('goal-selection').style.display = 'flex';
      });
      document.getElementById('close-modal').addEventListener('click', closeModal);
      document.getElementById('complete-btn').addEventListener('click', completeLevel);

      // delegate clicks for level nodes
      document.getElementById('quest-path').addEventListener('click', (e) => {
        const node = e.target.closest('.level-node');
        if (!node || node.classList.contains('locked')) return;
        const levelId = node.getAttribute('data-level');
        if (levelId) openLevelModal(levelId);
      });
    }

    // data handler
    const dataHandler = {
      onDataChanged(data){
        gameData = data || [];
        const goalEntry = data.find(d => d.level_id === 'goal');
        if (goalEntry && goalEntry.goal_selected){
          selectedGoal = goalEntry.goal_selected;
          document.getElementById('selected-goal').textContent = selectedGoal;
          document.getElementById('goal-selection').style.display = 'none';
          document.getElementById('game-screen').classList.add('active');
        }
        updateStats();
        renderQuestMap();
      }
    };

    async function init(){
      createParticles();
      wireEvents();
      await window.dataSdk.init(dataHandler);
      window.elementSdk.init({
        defaultConfig: window.elementSdk.config,
        onConfigChange: (cfg)=> window.elementSdk.setConfig(cfg)
      });
      // initial render (in case storage empty)
      renderQuestMap();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

